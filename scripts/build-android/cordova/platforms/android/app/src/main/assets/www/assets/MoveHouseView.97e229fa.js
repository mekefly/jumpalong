import{f as I,n as B,ap as _,y as v,z as E,A as e,H as t,C as l,a9 as J,O as u,U as ue,br as re,aP as C,D as c,F as r,bF as ie,I as z,J as D,L as K,G as de,X as A,S as ce,aZ as _e,_ as pe,aY as H,dJ as me}from"./index.de60ca02.js";import{_ as q,a as fe}from"./AddButton.vue_vue_type_script_setup_true_lang.afbaf71a.js";import{_ as ve,a as he,b as ye}from"./UserLink.vue_vue_type_script_setup_true_lang.c1cc397a.js";import{S as W}from"./Scrollbar.12236074.js";import{_ as ge}from"./Input.cc4eb912.js";import{_ as X}from"./Thing.d82451c6.js";import{_ as G}from"./RelayConnectListCard.vue_vue_type_script_setup_true_lang.1cd0d130.js";import{b as be,e as ke,j as we}from"./getCacheStaff.283a43f7.js";import{q as Ce}from"./use.9a2f80b1.js";import{a as Se,_ as xe}from"./Checkbox.f4d92c20.js";import{u as Le}from"./use-theme-vars.c1c11cee.js";import{_ as Ue}from"./Space.b6c95bbe.js";import{_ as Re}from"./Empty.316516f4.js";import"./RelayInfoView.e65832c0.js";import"./Ellipsis.e5fc37f4.js";import"./Icon.919891f2.js";import"./ListItem.e483f558.js";import"./DrawerContent.4dbf8f07.js";import"./user.a4fb9555.js";import"./nostr.656ef4cd.js";import"./Scrollbar.193872ed.js";import"./autoAddRelayurlByEventIdStaff.73b12553.js";import"./get-slot.4ceacf82.js";const $e=I({__name:"AddRelay",props:{show:{type:Boolean},disabledList:null},emits:["add-relay","update:show"],setup(h,{emit:f}){const k=B(()=>J.getOtherList()),m=_("");return(S,p)=>{const y=ge,x=X;return v(),E(ve,{show:h.show,"onUpdate:show":p[2]||(p[2]=d=>f("update:show",d)),closable:"",height:"100%",title:l(u)("add_relay")},{default:e(()=>[t(W,null,{default:e(()=>[t(x,{class:"my-2"},{header:e(()=>[t(y,{value:m.value,"onUpdate:value":p[0]||(p[0]=d=>m.value=d),placeholder:"eg: wss://relay.com",size:"small"},null,8,["value"])]),"header-extra":e(()=>[t(q,{onClick:p[1]||(p[1]=()=>f("add-relay",m.value)),disabled:h.disabledList&&h.disabledList.has(m.value)},null,8,["disabled"])]),_:1}),t(fe,{urls:l(k),loadable:""},{right:e(({url:d})=>[t(q,{onClick:()=>f("add-relay",d),disabled:h.disabledList&&h.disabledList.has(d)},null,8,["onClick","disabled"])]),_:1},8,["urls"])]),_:1})]),_:1},8,["show","title"])}}}),Pe=["id"],Te=C("div",{class:"grid grid-cols-2"},null,-1),tt=I({__name:"MoveHouseView",setup(h){const f=_(J.getReadList()),k=_(J.getWriteList()),m=_(!1),S=_(!1),p=[0,1,2,3,4,5,6,7,8,40,41,42,43,44,1984,9734,9735,1e4,10001,10002,3e4,30001,30008,30009,30023,30078],y=Ce("checkedKinds",p),x=[ue.value.publicKey],d=_([...x]),w=_(new Map),F=B(()=>[{kinds:y.value,authors:d.value}]),L=B(()=>(w.value.clear(),A.createChild().addStaff(be()).addFilters(F.value).addStaff({push(s){var o;const a=s.kind;w.value.set(a,((o=w.value.get(a))!=null?o:0)+1)}}).addExtends(A)));function Y(){m.value=!0,L.value.addExtends(A.createChild().addStaff(ke()).addFilters(F.value).addRelayUrls(f.value))}const O=me(),U=B(()=>{let s=0;for(const[a,o]of w.value)s+=o;return s}),R=_(new Map);function Z(){return{ok:0,error:0,ignore:0}}function Q(s,a){const o=a.get(s);if(!o){const i=Z();return R.value.set(s,i),i}return o}function ee(){const s=ce(new Map);R.value=s,S.value=!0,A.createChild().addFilters(F.value).addStaff({push(a){O.unShift(()=>{var o;L.value.getRelayEmiter().on("ok",a.id,({ok:i,url:T})=>{const g=Q(T,s);i?g.ok++:g.error++},{overtime:6e4});for(const i of k.value){if((o=we(a.id))!=null&&o.has(i)){Q(i,s).ignore++;continue}O.unShift(()=>{L.value.publish(a,new Set().add(i),{autoPublishToTagR:!1})})}})}}).addExtends(L.value)}const M=Le(),te=re(),$=_(null);function ae(s){var a;(a=$.value)==null||a.add(s),te.success(u("successfully_added"))}const P=_(!1);function le(){$.value=f.value,P.value=!0}function se(){$.value=k.value,P.value=!0}return(s,a)=>{const o=xe,i=X,T=Se,g=_e,V=pe,N=Ue,ne=Re;return v(),E(he,null,{default:e(({id:oe})=>{var j;return[t($e,{show:P.value,"onUpdate:show":a[0]||(a[0]=n=>P.value=n),onAddRelay:ae,disabledList:(j=$.value)!=null?j:void 0},null,8,["show","disabledList"]),C("div",{id:oe},[t(W,null,{default:e(()=>[t(N,{vertical:""},{default:e(()=>[t(g,{title:l(u)("kind")},{"header-extra":e(()=>[c(r(l(U)),1)]),default:e(()=>[t(T,{value:l(y),"onUpdate:value":[a[1]||(a[1]=n=>ie(y)?y.value=n:null),a[2]||(a[2]=()=>{m.value=!1,S.value=!1})]},{default:e(()=>[(v(),z(K,null,D(p,n=>t(i,null,{header:e(()=>[t(o,{value:n,label:l(u)(`kind${n}`)},null,8,["value","label"])]),"header-extra":e(()=>{var b;return[c(r((b=w.value.get(n))!=null?b:0),1)]}),_:2},1024)),64))]),_:1},8,["value"])]),_:1},8,["title"]),t(g,{title:l(u)("include_user")},{default:e(()=>[t(T,{value:d.value,"onUpdate:value":a[3]||(a[3]=n=>d.value=n)},{default:e(()=>[Te,(v(),z(K,null,D(x,n=>t(o,{value:n},{default:e(()=>[t(ye,{withPrefix:!1,value:n},null,8,["value"])]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1},8,["title"]),t(G,{urls:f.value,title:l(u)("pull")},{action:e(()=>[t(N,null,{default:e(()=>[t(V,{disabled:m.value,type:"primary",onClick:Y},{default:e(()=>[c(r(l(u)("pull")),1)]),_:1},8,["disabled"]),t(V,{type:"primary",onClick:le},{default:e(()=>[c(r(l(u)("add_relay")),1)]),_:1})]),_:1})]),_:1},8,["urls","title"]),t(G,{urls:k.value,title:l(u)("push")},{action:e(()=>[t(N,null,{default:e(()=>[t(V,{disabled:S.value||l(U)===0,type:"primary",onClick:ee},{default:e(()=>[c(r(l(u)("push"))+"("+r(l(U))+") ",1)]),_:1},8,["disabled"]),t(V,{type:"primary",onClick:se},{default:e(()=>[c(r(l(u)("add_relay")),1)]),_:1})]),_:1})]),_:1},8,["urls","title"]),t(g,{title:l(u)("result")},{"header-extra":e(()=>[c(r(l(U)),1)]),default:e(()=>[R.value.size===0?(v(),E(ne,{key:0,description:l(u)("empty_text")},null,8,["description"])):de("",!0),(v(!0),z(K,null,D(R.value,([n,b])=>(v(),E(i,null,{header:e(()=>[c(r(n),1)]),"header-extra":e(()=>[C("span",{style:H({color:l(M).successColor})},r(b.ok),5),c(" / "),C("span",{style:H({color:l(M).primaryColor})},r(b.ignore),5),c(" / "),C("span",{style:H({color:l(M).errorColor})},r(b.error),5)]),_:2},1024))),256))]),_:1},8,["title"])]),_:1})]),_:1})],8,Pe)]}),_:1})}}});export{tt as default};
